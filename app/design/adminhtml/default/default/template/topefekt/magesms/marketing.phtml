<?php
/**
 * Mage SMS - SMS notification & SMS marketing
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the BSD 3-Clause License
 * It is available through the world-wide-web at this URL:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * @category    TOPefekt
 * @package     TOPefekt_Magesms
 * @copyright   Copyright (c) 2012-2014 TOPefekt s.r.o. (http://www.mage-sms.com)
 * @license     http://opensource.org/licenses/BSD-3-Clause
 */
?><?php $user = $this->profile->user; ?><?php $lang = $this->profile->lang; ?><h2><?php echo Mage::helper('magesms')->__('SMS Marketing'); ?></h2><p><?php echo Mage::helper('magesms')->__('Write text of message and use advanced filter to target your marketing campaign.'); ?></p><div id="magesms"><div class="entry-edit"><div class="entry-edit-head"><h4 class="icon-head fieldset-legend head-account"><img src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_MEDIA).'magesms/AdminTools.gif'; ?>" alt="" /> <?php echo Mage::helper('magesms')->__('SMS Marketing - bulk SMS text'); ?></h4></div><div class="fieldset"><form name="formSMS" id="magesms_sendsms" action="<?php echo Mage::helper("adminhtml")->getUrl('*/*/send') ?>" enctype="multipart/form-data" method="post"><input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>" /><input name="filter" type="hidden" value="<?php echo $this->getRequest()->getParam('filter'); ?>" /><label for="text"><?php echo Mage::helper('magesms')->__('Enter SMS text'); ?></label><br /><div style="float: left;margin-right:30px;"><div class="margin-form"><textarea name="text" id="text" class="required-entry input-text" style="width:420px; height:135px;"><?php echo $this->getSmsData()->getData('text'); ?></textarea><div id="labelSMS"></div></div></div><div style="float: left; margin-top"><div class="margin-form"><input id="unicode" type="checkbox" value="1" name="unicode" <?php echo $this->getSmsData()->getData('unicode') ? 'checked' : ''; ?> /><label for="unicode"><?php echo Mage::helper('magesms')->__(' Unicode '); ?></label><span style="cursor:help;text-decoration:underline;" title="<?php echo Mage::helper('magesms')->__('Check only if you want to use Chinese, Arabic, Greek, Hebrew, Korean, Cyrillic, etc. or diacritic in the text of your SMS message (Unicode text allows you to insert characters in all fonts and various other symbols simultaneously. Number of characters in one SMS will be reduced to 70).'); ?>" onclick="popup_title(this)">?</span></div><div class="margin-form"><input type="hidden" value="0" name="unique" /><input id="unique" type="checkbox" value="1" name="unique" <?php echo $this->getSmsData()->getData('unique') === '0' ? '' : 'checked'; ?> /><label for="unique"><?php echo Mage::helper('magesms')->__('Remove duplicate numbers'); ?></label></div><div class="margin-form" style="margin-top: 10px"><input id="sendlater" type="checkbox" value="1" name="sendlater" <?php echo $this->getSmsData()->getData('sendlater') ? 'checked' : ''; ?> /><label for="sendlater"><?php echo Mage::helper('magesms')->__(' Send later '); ?></label></div><div class="margin-form sendlater-form" style="display: none; padding: 5px 0 0 20px"><label for="date"><?php echo Mage::helper('magesms')->__('Date:'); ?></label><?php $datumodesl = Mage::helper('core')->formatDate( ($_x = $this->getSmsData()->getData('datumodesl')) ? $_x.date(' H:i:s', Mage::getModel('core/date')->timestamp(time())) : date('Y-m-d H:i:s', Mage::getModel('core/date')->timestamp(time())+24*60*60), 'short', false); ?><input type="text" style="width: 100px;" class="input-text validate-sendlater-datumodesl" value="<?php echo $datumodesl; ?>" id="datumodesl" name="datumodesl"/><img style="cursor:pointer" title="<?php echo Mage::helper('magesms')->__('Calendar'); ?>" id="date_select_trig" class="v-middle" alt="" src="<?php echo $this->getSkinUrl("images/grid-cal.gif");?> "/>&nbsp;&nbsp;&nbsp;&nbsp;<label for="date"><?php echo Mage::helper('magesms')->__('Time: '); ?></label><select name="datumodesl_hour"><?php for($hour=1;$hour<=24;$hour++): ?><option value="<?php echo $hour; ?>" <?php echo (($_x = $this->getSmsData()->getData('datumodesl_hour')) ? $_x : 9 ) == $hour ? 'selected' : ''; ?>><?php printf('%02d', $hour); ?></option><?php endfor; ?></select>:<select name="datumodesl_min"><?php for($min=0;$min<=59;$min++): ?><option value="<?php echo $min; ?>" <?php echo $this->getSmsData()->getData('datumodesl_min') == $min ? 'selected' : ''; ?>><?php printf('%02d', $min); ?></option><?php endfor; ?></select><script type="text/javascript">//<![CDATA[
jQuery(document).ready(function() {jQuery('#sendlater').click(function() {jQuery('.sendlater-form').toggle();});if (jQuery('#sendlater').attr('checked')) {jQuery('.sendlater-form').show();};});Calendar.setup({inputField: "datumodesl",ifFormat: "<?php echo Mage::app()->getLocale()->getDateStrFormat(Mage_Core_Model_Locale::FORMAT_TYPE_SHORT); ?>",button: "date_select_trig",align: "Bl",singleClick : true});
//]]></script></div><div class="margin-form sendlater-form" style="display: none; padding: 5px 0 0 20px"><label for="datereal"><?php echo Mage::helper('magesms')->__('Your time: '); ?></label><?php $date = Mage::app()->getLocale()->date()->toString(); ?><select id="datereal" name="datereal"><option value="-1" <?php echo $this->getSmsData()->getData('datereal') == -1 ? 'selected' : ''; ?>><?php echo $date; ?> -<?php echo Mage::helper('magesms')->__('1hr'); ?></option><option value="0" <?php echo $this->getSmsData()->getData('datereal', 0) == 0 ? 'selected' : ''; ?>><?php echo $date; ?></option><option value="1" <?php echo $this->getSmsData()->getData('datereal') == 1 ? 'selected' : ''; ?>><?php echo $date; ?> +<?php echo Mage::helper('magesms')->__('1hr'); ?></option></select>&nbsp;&nbsp;&nbsp;&nbsp;(<?php echo Mage::helper('magesms')->__('time zone: '); ?><span style="cursor:help;" title="<?php echo Mage::helper('magesms')->__('time zone settings'); ?>"><a href="<?php echo Mage::helper("adminhtml")->getUrl('adminhtml/system_config/edit/section/general/', array('_fragment' => 'general_locale-head')); ?>" target="_blank"><?php echo Mage::app()->getStore()->getConfig('general/locale/timezone'); ?></a></span>)</div></div><div class="clear"></div><div class="margin-form" style="margin-left:500px"><button type="button" onclick="sendForm.submit();" title="<?php echo Mage::helper('magesms')->__('Send'); ?>" name="submitSend" class="form-button" /><span><span><span><?php echo Mage::helper('magesms')->__('Send'); ?></span></span></span></button><!--<input type="button" onclick="sendForm.submit();" value="<?php echo Mage::helper('magesms')->__('Send'); ?>" name="submitSend" class="form-button" />--></div></form><script type="text/javascript">//<![CDATA[
var sendForm = new varienForm('magesms_sendsms');sendForm.submit = function() {if (this.validator.validate()) {if (confirm('<?php echo Mage::helper('magesms')->__('Send').' '.Mage::helper('magesms')->__('SMS').'?'; ?>')) {varienForm.prototype.submit.bind(this)();}return false;}};Validation.add('validate-sendlater-datumodesl','Please enter a valid date.', function(v) {return !$('sendlater').checked || $('sendlater').checked && !Validation.get('IsEmpty').test(v);});
//]]></script></div></div><script type="text/javascript">//<![CDATA[
countitSMS = new countitSMS(document.getElementById('text'), document.getElementById('unicode'), document.getElementById('labelSMS'));countitSMS.chartext1 = '<?php echo Mage::helper('magesms')->__('Characters: '); ?>';countitSMS.chartext2 = '<?php echo Mage::helper('magesms')->__('SMS: '); ?>';countitSMS.alert = '<?php echo Mage::helper('magesms')->__('Text is too long'); ?>';countitSMS.marketingCustomers = '<?php echo Mage::helper('magesms')->__('Total customers:'); ?>';countitSMS.marketingTotal = '<?php echo Mage::helper('magesms')->__('Total SMS:'); ?>';countitSMS.count();
//]]></script><script type="text/javascript">//<![CDATA[
function filterFormSubmit() {var filters = $$('#marketing_filter input', '#marketing_filter select');var elements = [];for(var i in filters){if(filters[i].value && filters[i].value.length && !filters[i].disabled) elements.push(filters[i]);}var validator= new Validation('marketing_filter');if (validator.validate()) {ret = '';if (elements.length)ret = 'filter/' + encode_base64(Form.serializeElements(elements))+'/';setLocation('<?php echo $this->getFilterUrl(); ?>' + ret + sendFormSubmit());}}function filterResetFormSubmit() {var validator= new Validation('marketing_filter');if (validator.validate()) {setLocation('<?php echo $this->getFilterUrl(); ?>');}}function filterRemoveCustomerSubmit(obj) {var hidden = $('magesms_marketing_customer_not');hidden.value = hidden.value + ',' + obj.id;filterFormSubmit();}function sendFormSubmit() {var ret = '';var elements = [];var filters = $$('#magesms_sendsms input', '#magesms_sendsms textarea', '#magesms_sendsms select');for(var i in filters){if(filters[i].value && filters[i].value.length && !filters[i].disabled) {elements.push(filters[i]);}}if (elements.length) {ret = 'sms/' + encode_base64(Form.serializeElements(elements))+'/';}return ret;}
//]]></script></div>